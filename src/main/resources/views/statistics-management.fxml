<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.*?>

<StackPane xmlns="http://javafx.com/javafx/8.0.171"
           xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="com.ptudn12.main.controller.StatisticsManagementController"
           stylesheets="@statistics-management-styles.css">

    <VBox spacing="15">
        <padding>
            <Insets top="15" right="15" bottom="15" left="15"/>
        </padding>
        
        <HBox alignment="CENTER_LEFT" spacing="15">
            <Label text="ðŸ“Š Thá»‘ng kÃª chi tiáº¿t theo tuyáº¿n Ä‘Æ°á»ng" style="-fx-font-size: 20px; -fx-font-weight: bold;"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="ðŸ“Š Xuáº¥t Excel" onAction="#handleExportExcel" fx:id="btnExportExcel" styleClass="action-button" style="-fx-background-color: #217346; -fx-padding: 10 20; -fx-font-size: 13px;"/>
            <Button text="ðŸ“„ Xuáº¥t PDF" onAction="#handleExportPDF" fx:id="btnExportPDF" styleClass="action-button" style="-fx-padding: 10 20; -fx-font-size: 13px;"/>
        </HBox>

        <!-- Lá»c vÃ  TÃ¬m Kiáº¿m -->
        <TitledPane text="ðŸ” Bá»™ Lá»c vÃ  TÃ¬m Kiáº¿m" animated="true" collapsible="true" expanded="false" style="-fx-font-size: 14px; -fx-font-weight: bold;">
            <VBox spacing="15" style="-fx-padding: 15; -fx-background-color: white;">
                <!-- Ã´ tÃ¬m kiáº¿m -->
                <HBox alignment="CENTER_LEFT" spacing="15">
                    <TextField fx:id="txtSearch" promptText="ðŸ” TÃ¬m tÃªn tuyáº¿n..." onKeyReleased="#handleSearch" prefWidth="220" styleClass="search-field"/>
                    <TextField fx:id="txtMaTuyen" promptText="ðŸ·ï¸ TÃ¬m mÃ£ tuyáº¿n..." onKeyReleased="#handleFilterByCode" prefWidth="160" styleClass="search-field"/>
                    <TextField fx:id="txtTiLe" promptText="ðŸ“Š Tá»· lá»‡ láº¥p Ä‘áº§y > %" onKeyReleased="#handleFilterByRatio" prefWidth="170" styleClass="search-field"/>
                    <Button text="ðŸ”„ LÃ m má»›i" onAction="#handleResetFilters" styleClass="secondary-button" style="-fx-padding: 8 15;"/>
                </HBox>

                <!-- Lá»c theo ngÃ y (dÃ nh cho nhÃ¢n viÃªn) -->
                <HBox fx:id="dateFilterBox" spacing="15" alignment="CENTER_LEFT" visible="false">
                    <Label text="ðŸ“… Lá»c theo ngÃ y:" style="-fx-font-weight: bold; -fx-font-size: 13px;"/>
                    <DatePicker fx:id="dpDate" prefWidth="180"/>
                    <Button text="ðŸ“¥ Lá»c" onAction="#handleFilterByDate" styleClass="action-button" style="-fx-background-color: #4472C4; -fx-padding: 8 16;"/>
                </HBox>
                
                <!-- Lá»c theo thÃ¡ng/nÄƒm (dÃ nh cho quáº£n lÃ½) -->
                <VBox fx:id="monthYearFilterBox" spacing="12" visible="false">
                    <HBox spacing="12" alignment="CENTER_LEFT">
                        <Label text="ðŸ“… Lá»c theo thÃ¡ng:" style="-fx-font-weight: bold; -fx-font-size: 13px;"/>
                        <ComboBox fx:id="cbMonth" prefWidth="120" promptText="Chá»n thÃ¡ng"/>
                        <Label text="NÄƒm:"/>
                        <Spinner fx:id="spYear" prefWidth="110"/>
                        <Button text="ðŸ“¥ Lá»c" onAction="#handleFilterByMonthYear" styleClass="action-button" style="-fx-background-color: #4472C4; -fx-padding: 8 15;"/>
                    </HBox>
                    <Separator style="-fx-background-color: #e0e0e0; -fx-padding: 0;"/>
                    <HBox spacing="12" alignment="CENTER_LEFT">
                        <Label text="ðŸ“… Hoáº·c lá»c theo nÄƒm:" style="-fx-font-weight: bold; -fx-font-size: 13px;"/>
                        <Spinner fx:id="spYearOnly" prefWidth="110"/>
                        <Button text="ðŸ“¥ Lá»c" onAction="#handleFilterByYear" styleClass="action-button" style="-fx-background-color: #4472C4; -fx-padding: 8 15;"/>
                    </HBox>
                </VBox>
            </VBox>
        </TitledPane>

        <TabPane VBox.vgrow="ALWAYS" tabClosingPolicy="UNAVAILABLE" style="-fx-font-size: 13px;">
            <Tab text="ðŸ“Š Thá»‘ng kÃª Tuyáº¿n" style="-fx-font-size: 13px;">
                <VBox spacing="5" style="-fx-background-color: white;">
                    <padding>
                        <Insets top="8" right="8" bottom="8" left="8"/>
                    </padding>
                    <TableView fx:id="tableStats" VBox.vgrow="ALWAYS" style="-fx-font-size: 12px;">
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                        </columnResizePolicy>
                        <columns>
                            <TableColumn text="MÃ£ tuyáº¿n" fx:id="colMaTuyen"/>
                            <TableColumn text="TÃªn tuyáº¿n" fx:id="colTenTuyen"/>
                            <TableColumn text="Tá»•ng vÃ© bÃ¡n" fx:id="colTongVe"/>
                            <TableColumn text="Sá»‘ vÃ© trá»‘ng" fx:id="colSoVeTrong"/>
                            <TableColumn text="Tá»· lá»‡ láº¥p Ä‘áº§y" fx:id="colTiLe"/>
                            <TableColumn text="Sá»‘ chuyáº¿n" fx:id="colSoChuyen"/>
                            <TableColumn text="Doanh thu (VND)" fx:id="colDoanhThu"/>
                            <TableColumn text="Doanh thu TB/Chuyáº¿n" fx:id="colDoanhThuTB"/>
                        </columns>
                    </TableView>
                </VBox>
            </Tab>
            <Tab text="ðŸ‘¥ Top 10 KhÃ¡ch HÃ ng" style="-fx-font-size: 13px;">
                <VBox spacing="5" style="-fx-background-color: white;">
                    <padding>
                        <Insets top="8" right="8" bottom="8" left="8"/>
                    </padding>
                    <TableView fx:id="tableTopCustomers" VBox.vgrow="ALWAYS" style="-fx-font-size: 12px;">
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                        </columnResizePolicy>
                        <columns>
                            <TableColumn text="MÃ£ KH" fx:id="colMaKH"/>
                            <TableColumn text="TÃªn KhÃ¡ch HÃ ng" fx:id="colTenKH"/>
                            <TableColumn text="Sá»‘ Äiá»‡n Thoáº¡i" fx:id="colSDT"/>
                            <TableColumn text="Sá»‘ VÃ© ÄÃ£ Mua" fx:id="colSoVeDaMua"/>
                            <TableColumn text="Tá»•ng Tiá»n (VND)" fx:id="colTongTienKH"/>
                        </columns>
                    </TableView>
                </VBox>
            </Tab>
        </TabPane>
    </VBox>
    
    <StackPane fx:id="loadingPane" visible="false" style="-fx-background-color: rgba(255, 255, 255, 0.7);">
        <ProgressIndicator maxWidth="50" maxHeight="50"/>
    </StackPane>
</StackPane>