<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.*?>

<StackPane xmlns="http://javafx.com/javafx/8.0.171"
           xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="com.ptudn12.main.controller.StatisticsManagementController"
           stylesheets="@statistics-management-styles.css">

    <VBox spacing="20">
        <padding>
            <Insets top="20" right="20" bottom="20" left="20"/>
        </padding>
        
        <HBox alignment="CENTER_LEFT" spacing="15">
            <Label text="Thống kê chi tiết theo tuyến đường" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="Xuất Excel" onAction="#handleExportExcel" fx:id="btnExportExcel" styleClass="action-button" style="-fx-background-color: #217346;"/>
            <Button text="Xuất PDF" onAction="#handleExportPDF" fx:id="btnExportPDF" styleClass="action-button"/>
        </HBox>

        <HBox spacing="15" alignment="CENTER_LEFT" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 5; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 5, 0, 0, 1);">
            <TextField fx:id="txtSearch" promptText="Tìm tên tuyến..." onKeyReleased="#handleSearch" prefWidth="200" styleClass="search-field"/>
            <TextField fx:id="txtMaTuyen" promptText="Tìm mã tuyến..." onKeyReleased="#handleFilterByCode" prefWidth="150" styleClass="search-field"/>
            <TextField fx:id="txtTiLe" promptText="Tỷ lệ lấp đầy > %" onKeyReleased="#handleFilterByRatio" prefWidth="150" styleClass="search-field"/>
            <Button text="Làm mới" onAction="#handleResetFilters" styleClass="secondary-button"/>
        </HBox>

        <TabPane VBox.vgrow="ALWAYS" tabClosingPolicy="UNAVAILABLE">
            <Tab text="Thống kê Tuyến">
                <VBox spacing="10">
                    <padding>
                        <Insets top="10" right="10" bottom="10" left="10"/>
                    </padding>
                    <TableView fx:id="tableStats" VBox.vgrow="ALWAYS">
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                        </columnResizePolicy>
                        <columns>
                            <TableColumn text="Mã tuyến" fx:id="colMaTuyen"/>
                            <TableColumn text="Tên tuyến" fx:id="colTenTuyen"/>
                            <TableColumn text="Tổng vé bán" fx:id="colTongVe"/>
                            <TableColumn text="Số vé trống" fx:id="colSoVeTrong"/>
                            <TableColumn text="Tỷ lệ lấp đầy" fx:id="colTiLe"/>
                            <TableColumn text="Số chuyến" fx:id="colSoChuyen"/>
                            <TableColumn text="Doanh thu (VND)" fx:id="colDoanhThu"/>
                            <TableColumn text="Doanh thu TB/Chuyến" fx:id="colDoanhThuTB"/>
                        </columns>
                    </TableView>
                </VBox>
            </Tab>
            <Tab text="Top 10 Khách Hàng">
                <VBox spacing="10">
                    <padding>
                        <Insets top="10" right="10" bottom="10" left="10"/>
                    </padding>
                    <TableView fx:id="tableTopCustomers" VBox.vgrow="ALWAYS">
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                        </columnResizePolicy>
                        <columns>
                            <TableColumn text="Mã KH" fx:id="colMaKH"/>
                            <TableColumn text="Tên Khách Hàng" fx:id="colTenKH"/>
                            <TableColumn text="Số Điện Thoại" fx:id="colSDT"/>
                            <TableColumn text="Số Vé Đã Mua" fx:id="colSoVeDaMua"/>
                            <TableColumn text="Tổng Tiền (VND)" fx:id="colTongTienKH"/>
                        </columns>
                    </TableView>
                </VBox>
            </Tab>
        </TabPane>
    </VBox>
    
    <StackPane fx:id="loadingPane" visible="false" style="-fx-background-color: rgba(255, 255, 255, 0.7);">
        <ProgressIndicator maxWidth="50" maxHeight="50"/>
    </StackPane>
</StackPane>